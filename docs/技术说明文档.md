# ForensicHub 项目技术说明文档

## 项目概述

ForensicHub 是一个统一的图像取证基准测试平台，专注于全领域的假图像检测和定位。这个项目整合了四个主要的图像取证任务：

1. **Deepfake检测** - 检测AI生成的虚假人脸图像
2. **图像篡改检测与定位** - 检测和定位图像中的篡改区域
3. **AI生成图像检测** - 区分真实图像和AI生成的图像
4. **文档图像篡改检测** - 专门处理文档图像的篡改检测

## 项目架构

ForensicHub 采用模块化设计，主要包含以下几个核心组件：

```
ForensicHub/
├── core/                   # 核心模块 - 提供抽象基类
│   ├── base_model.py      # 模型基类
│   ├── base_dataset.py    # 数据集基类
│   ├── base_transform.py  # 数据变换基类
│   └── __init__.py
├── common/                 # 通用模块
│   ├── backbones/         # 骨干网络（ResNet、ViT等）
│   ├── evaluation/        # 评估指标（F1、AUC等）
│   ├── utils/             # 工具函数
│   └── wrapper/           # 包装器
├── tasks/                  # 具体任务模块
│   ├── aigc/              # AI生成图像检测
│   ├── deepfake/          # 深度伪造检测
│   ├── document/          # 文档篡改检测
│   └── imdl/              # 图像篡改检测与定位
├── statics/               # 配置文件
│   ├── aigc/             # AIGC任务配置
│   ├── deepfake/         # Deepfake任务配置
│   ├── document/         # 文档任务配置
│   └── imdl/             # IMDL任务配置
└── training_scripts/     # 训练和测试脚本
    ├── train.py          # 训练主脚本
    ├── test.py           # 测试主脚本
    └── inference.py      # 单图像推理脚本
```

## 核心组件说明

### 1. 核心模块 (core/)

这是整个框架的基础，定义了所有组件的统一接口：

- **base_model.py**: 所有模型的基类，定义了前向传播、损失计算和评估接口
- **base_dataset.py**: 数据集基类，统一数据格式和加载方式
- **base_transform.py**: 数据变换基类，统一数据预处理流程

### 2. 通用模块 (common/)

提供可复用的组件：

- **backbones/**: 包含各种预训练模型骨干网络
  - ResNet系列
  - Vision Transformer (ViT)
  - MobileNet
  - DenseNet
  - EfficientNet

- **evaluation/**: 评估指标实现
  - 图像级评估：准确率、F1分数、AUC等
  - 像素级评估：IoU、F1分数等

- **utils/**: 通用工具函数
- **wrapper/**: 对不同组件的包装，确保接口统一

### 3. 任务模块 (tasks/)

每个子任务都有完整的实现：

#### AIGC任务 (tasks/aigc/)
- **models/**: AIGC检测模型
  - FatFormer: 新增的AIGC检测模型
  - ResNet: 基础分类模型
  - 其他预训练模型适配

- **datasets/**: AIGC数据集处理
  - 支持JSON格式的数据标注
  - 数据加载和预处理

- **transforms/**: AIGC专用的数据增强
  - 标准化处理
  - 图像增强

#### Deepfake任务 (tasks/deepfake/)
- **models/**: Deepfake检测模型
- **datasets/**: 人脸数据集处理
- **transforms/**: 人脸专用数据预处理

#### 文档任务 (tasks/document/)
- **models/**: 文档篡改检测模型
  - TIFDM: 文档图像伪造检测模型
  - CFTB: 文档篡改检测网络
  - DTD: 文档篡改检测模型

- **datasets/**: 文档数据集处理
- **utils/**: 文档专用工具函数

#### IMDL任务 (tasks/imdl/)
- **models/**: 图像篡改检测和定位模型
- **datasets/**: 通用图像数据集处理
- **transforms/**: 图像数据增强

### 4. 配置文件 (statics/)

使用YAML格式的配置文件管理所有实验设置：

```yaml
# 示例配置文件结构
model:
  name: Resnet50
  init_config:
    pretrained: true
    num_classes: 1

train_dataset:
  name: AIGCLabelDataset
  init_config:
    image_size: 224
    path: data/train.json

transform:
  name: AIGCTransform

evaluator:
  - name: ImageF1
    init_config:
      threshold: 0.5
```

### 5. 训练脚本 (training_scripts/)

- **train.py**: 主要的训练脚本，支持分布式训练
- **test.py**: 模型评估脚本
- **inference.py**: 单图像推理脚本
- **schedular/**: 学习率调度器实现
- **utils/**: 训练相关工具函数

## 技术栈

### 主要依赖
- **PyTorch**: 深度学习框架
- **TorchVision**: 视觉模型和工具
- **OpenCV**: 图像处理
- **Albumentations**: 数据增强
- **timm**: 各种预训练模型
- **EfficientNet-PyTorch**: EfficientNet模型
- **scikit-learn**: 机器学习工具
- **TensorFlow**: 部分模型兼容性
- **Grad-CAM**: 可视化工具

### 开发工具
- **Python 3.7+**: 主要开发语言
- **Git**: 版本控制
- **PyPI**: 包管理
- **Conda/Virtualenv**: 环境管理

## 工作流程

### 1. 数据准备
- 将数据组织成JSON格式
- 使用统一的数据集接口加载
- 支持多种数据源格式

### 2. 模型训练
- 通过YAML配置文件指定模型、数据集和训练参数
- 支持分布式训练
- 自动保存最佳模型

### 3. 模型评估
- 使用多种评估指标
- 支持GPU加速评估
- 自动生成评估报告

### 4. 单图像推理
- 支持对单个图像进行预测
- 提供可视化结果
- 易于集成到其他系统中

## 文件关系图

```
配置文件 (YAML)
    ↓
训练脚本 (training_scripts/train.py)
    ↓
注册系统 (registry.py)
    ↓
┌─────────┬─────────┬─────────┬─────────┐
│  数据集  │  模型   │  变换   │  评估器  │
│Dataset  │ Model  │Transform│Evaluator│
└─────────┴─────────┴─────────┴─────────┘
    ↓         ↓         ↓         ↓
┌─────────────────────────────────────┐
│            核心抽象类                │
│        (core/base_*.py)             │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│        统一的前向传播和训练流程       │
└─────────────────────────────────────┘
```

## 使用示例

### 训练AIGC检测模型
```bash
# 1. 准备数据格式
[
  {"path": "image1.jpg", "label": 0},
  {"path": "image2.jpg", "label": 1}
]

# 2. 配置YAML文件
# 参考 statics/aigc/resnet_train.yaml

# 3. 开始训练
python training_scripts/train.py --config path/to/config.yaml
```

### 单图像推理
```python
from ForensicHub import *

model = MODELS.build(name="Resnet50", init_config={...})
result = model.get_prediction({"image": image_tensor})
```

## 特色功能

1. **模块化设计**: 易于扩展新模型、新数据集和新评估指标
2. **配置驱动**: 通过YAML配置文件管理整个实验流程
3. **多任务支持**: 统一框架支持多种图像取证任务
4. **高性能**: 支持分布式训练和GPU加速
5. **易于使用**: 提供完整的训练、评估和推理脚本

## 总结

ForensicHub 是一个功能强大、设计优雅的图像取证框架，通过统一的接口和模块化设计，让研究者能够快速开发和部署各种图像取证模型。无论你是入门级研究者还是有经验的开发者，都可以在这个框架的基础上快速实现自己的想法。